{% load static %}
{% load jalali_tags %}
{% load crispy_forms_tags %}




{% include 'includs/header.html' %}


<link rel="stylesheet" href="{% static 'vendor/fonts/boxicons.css' %}">
<link rel="stylesheet" href="{% static 'vendor/fonts/fontawesome.css' %}">
<link rel="stylesheet" href="{% static 'vendor/fonts/flag-icons.css' %}">

<!-- Core CSS -->
<link rel="stylesheet" href="{% static 'vendor/css/rtl/core.css' %}" class="template-customizer-core-css">
<link rel="stylesheet" href="{% static 'vendor/css/rtl/theme-default.css' %}" class="template-customizer-theme-css">
<link rel="stylesheet" href="{% static 'css/demo.css' %}">
<link rel="stylesheet" href="{% static 'vendor/css/rtl/rtl.css' %}">

<!-- Vendors CSS -->
<link rel="stylesheet" href="{% static 'vendor/libs/perfect-scrollbar/perfect-scrollbar.css' %}">
<link rel="stylesheet" href="{% static 'vendor/libs/typeahead-js/typeahead.css' %}">
<link rel="stylesheet" href="{% static 'vendor/libs/flatpickr/flatpickr.css' %}">
<link rel="stylesheet" href="{% static 'vendor/libs/pickr/pickr-themes.css' %}">
<link rel="stylesheet" href="{% static 'vendor/libs/select2/select2.css' %}">
<link rel="stylesheet" href="{% static 'vendor/libs/sweetalert2/sweetalert2.css' %}">
<!-- Page CSS -->

<!-- Helpers -->
<script src="{% static 'vendor/js/helpers.js' %}"></script>

<!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
<!--? Template customizer: To hide customizer set displayCustomizer value false in config.js.  -->
<script src="{% static 'vendor/js/template-customizer.js' %}"></script>
<!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
<script src="{% static 'js/config.js' %}"></script>


<div class="container-fluid">
    <h1>مشاهده بازدیدها</h1>
</div>





{% for message in messages %}
    {% if message.tags == 'error' %}
        <div class="alert alert-danger">{{ message }}</div>
    {% else %}
        <div class="alert alert-{{ message.tags }}">{{ message }}</div>
    {% endif %}
{% endfor %}

<div class="card">
    <div class="card-body">
        <!-- View Review Details -->
        <div class="row g-3">
            <div class="d-flex" style="justify-content: space-between;">
                <h4>جزئیات درخواست بازدید</h4>
                <button href="#" data-bs-target="#reviewTaskAdd" data-bs-toggle="modal"
                        class="btn btn-success">ثبت
                    بازدید جدید
                </button>
            </div>

            <div class="table-responsive">
                <table class="table table-bordered">
                    <tr>
                        <td colspan="2">درخواست کننده : <b>{{ review.user.profile }}</b></td>
                        <td colspan="2">تاریخ درخواست : <b>{{ review.createdAt|to_jalali:"%y/%m/%d" }}</b></td>
                    </tr>
                    <tr>
                        <td>دستگاه : <b>{{ review.machineName }}</b></td>
                        <td>قطعه : <b>{{ review.partName }}</b></td>
                        <td>دوره بازدید : <b>{{ review.reviewCount }} {{ review.get_reviewPeriod }}</b></td>
                    </tr>
                </table>
            </div>

            {% if review.reviewtask_set.all %}
                <div class="table-responsive">
                    <h4>لیست بازدید های انجام شده</h4>
                    <table class="table table-bordered text-center">
                        <thead>
                        <tr>
                            <th>تاریخ</th>
                            <th>شرح فعالیت</th>
                            <th>وضعیت</th>
                            <th>عملیات</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for task in review.reviewtask_set.all %}
                            <tr>
                                <td>{{ task.createdAt|to_jalali:'%y/%m/%d' }}</td>
                                <td>
                                    <input type="text" class="form-control" name="description"
                                           id="description_{{ task.id }}" value="{{ task.description }}" disabled>
                                </td>
                                <td>
                                    <select name="done" id="done_{{ task.id }}" class="form-select" disabled>
                                        <option value="1" {% if task.done %} selected {% endif %}>انجام شده</option>
                                        <option value="0" {% if not task.done %} selected {% endif %}>انجام نشده
                                        </option>
                                    </select>
                                </td>
                                <td>
                                    <button data-id="{{ task.id }}" data-function="edit"
                                            class="btn btn-sm btn-icon reviewTaskEditBtn">
                                        <i class="bx bx-edit"></i>
                                    </button>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-warning">بازدیدی انجام نشده است</div>
            {% endif %}
        </div>
        <!--/ View Review Details -->
    </div>
</div>

<div class="modal fade" id="reviewTaskAdd" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-add-new-role">
        <div class="modal-content p-3 p-md-5">
            <button type="button" class="btn-close btn-pinned" data-bs-dismiss="modal" aria-label="Close"></button>
            <div class="modal-body">
                <h4>افزودن بازدید جدید</h4>
                <form action="{% url 'reviewtask_add' review.id %}" method="post">
                    {% csrf_token %}

                    <div class="col-md-4">
                        <label for="" class="form-label">وضعیت</label>
                        <select class="form-select" name="done" id="">
                            <option value="1">انجام شد</option>
                            <option value="0">انجام نشد</option>
                        </select>
                    </div>
                    <div class="col-md-12 mb-2">
                        <label class="form-label">توضیحات</label>
                        <textarea class="form-control" name="description" id="" cols="30" rows="3"></textarea>
                    </div>

                    <div class="col-md-12" style="text-align: left;">
                        <button type="submit" class="btn btn-label-primary">ثبت</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


{% include 'includs/jsfooter.html' %}


<script src="{% static 'vendor/libs/jquery/jquery.js' %}"></script>
<script src="{% static 'vendor/libs/popper/popper.js' %}"></script>
<script src="{% static 'vendor/js/bootstrap.js' %}"></script>
<script src="{% static 'vendor/libs/perfect-scrollbar/perfect-scrollbar.js' %}"></script>

<script src="{% static 'vendor/libs/hammer/hammer.js' %}"></script>

<script src="{% static 'vendor/libs/i18n/i18n.js' %}"></script>
<script src="{% static 'vendor/libs/typeahead-js/typeahead.js' %}"></script>

<script src="{% static 'vendor/js/menu.js' %}"></script>
<!-- endbuild -->

<!-- Vendors JS -->
<script src="{% static 'vendor/libs/jdate/jdate.js' %}"></script>
<script src="{% static 'vendor/libs/flatpickr/flatpickr-jdate.js' %}"></script>
<script src="{% static 'vendor/libs/flatpickr/l10n/fa-jdate.js' %}"></script>
<script src="{% static 'vendor/libs/apex-charts/apexcharts.js' %}"></script>
<script src="{% static 'vendor/libs/pickr/pickr.js' %}"></script>

{#<script src="{% static 'vendor/libs/formvalidation/dist/js/FormValidation.min.js' %}"></script>#}
{#<script src="{% static 'vendor/libs/formvalidation/dist/js/plugins/Bootstrap5.min.js' %}"></script>#}
{#<script src="{% static 'vendor/libs/formvalidation/dist/js/plugins/AutoFocus.min.js' %}"></script>#}

<!-- Main JS -->
<script src="{% static 'js/main.js' %}"></script>

<!-- Vendors JS -->
<script src="{% static 'vendor/libs/autosize/autosize.js' %}"></script>
<script src="{% static 'vendor/libs/select2/select2.js' %}"></script>
<script src="{% static 'vendor/libs/jquery-repeater/jquery-repeater.js' %}"></script>
<script src="{% static 'vendor/libs/sweetalert2/sweetalert2.js' %}"></script>
<script src="{% static 'vendor/libs/cleavejs/cleave-phone.js' %}"></script>
<script src="{% static 'vendor/libs/cleavejs/cleave.js' %}"></script>

<!-- Page JS -->
<script src="{% static 'js/forms-extras.js' %}"></script>
<script src="{% static 'js/dashboards-analytics.js' %}"></script>
<script src="{% static 'js/app-access-roles.js' %}"></script>
<script src="{% static 'js/forms-selects.js' %}"></script>
<script src="{% static 'js/forms-pickers.js' %}"></script>
<script src="{% static 'js/order-detail.js' %}"></script>
<script src="{% static 'js/custom-switch.js' %}"></script>
<script src="{% static 'js/reviewTask.js' %}"></script>
<script src="{% static 'js/paginate.js' %}"></script>
<script src="{% static 'js/app-invoice-edit.js' %}"></script>
<script src="{% static 'js/offcanvas-add-payment.js' %}"></script>
{#<script src="{% static 'js/offcanvas-send-payment.js' %}"></script>#}
<script src="{% static 'js/extended-ui-sweetalert2.js' %}"></script>
<script src="{% static 'js/tables-datatables-advanced.js' %}"></script>
<script src="{% static 'js/ui-modals.js' %}"></script>